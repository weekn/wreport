<script id="addReportTmpl" type="text/x-jsrender">
    <div class="report_top">
        <img style="border:1px solid rgb(219,220,224);width:38px;height:38px;padding:2px;border-radius:8px;background-color: #FFF;margin-bottom: 2px" src="plugins/img/user.png" />
        <span style="color:#000;margin-left:5px">weekn</span>
    </div>
    {^{props reportItem}}
    <div class="report_item" item="{{>prop.report_item_num}}">
        <div class="report_category">
            <div><span class="glyphicon glyphicon-minus"></span></div>
            <div class="dropdown">
                <div data-toggle="dropdown" class='report_category_dropdown'>未选择</div>
                <ul class="dropdown-menu" role="menu" level="l0">
                    <li class="dropdown-header">一级项目</li>
                    {^{props prop.option_0}}
                        <li role="presentation"><a catagory_id="" role="menuitem" tabindex="-1" href="javascript:void(0)">{{>prop.name}}</a></li>
                    {{/props}}
                </ul>
            </div>
            <div><span class="glyphicon glyphicon-chevron-right"></span></div>
            <div class="dropdown">
                <div class='report_category_dropdown' data-toggle="dropdown">未选择</div>
                <ul class="dropdown-menu" role="menu" level="l1">
                    <li class="dropdown-header">二级项目</li>
                    {^{props prop.option_1}}
                        <li role="presentation"><a catagory_id="" role="menuitem" tabindex="-1" href="javascript:void(0)">{{>prop.name}}</a></li>
                    {{/props}}
                </ul>
            </div>
            <div><span class="glyphicon glyphicon-chevron-right"></span></div>
            <div class="dropdown">
                <div class='report_category_dropdown' data-toggle="dropdown">未选择</div>
                <ul class="dropdown-menu dropdown-menu-right" role="menu" level="l2">
                    <li class="dropdown-header">三级项目</li>
                    {^{props prop.option_2}}
                        <li role="presentation"><a catagory_id="" role="menuitem" tabindex="-1" href="javascript:void(0)">{{>prop.name}}</a></li>
                    {{/props}}
                </ul>
            </div>
            <div style="float: right;margin-right:15px" class="dropdown">
                <span class="glyphicon glyphicon-th" data-toggle="dropdown"></span>
                <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownMenu1">
                    <li role="presentation" name='report_item_remove' class="report_cata_option">删除</li>
                </ul>
            </div>
        </div>
        <div class="report_content" style="width:95%;margin:0 auto">
            <div class="report_entry" tabindex="0">
                <div class="report_entry_title">本周成果</div>
                <!-- <div class="report_outcome"></div> -->
                <div style="margin:0 auto;width:95%">
                    <div class="report_menu report_menu_outcome" tabindex="0"></div>
                    <div class="report_editor report_outcome" style="border-left: 3px solid rgb(245,245,245)"></div>
                </div>
            </div>
            <div class="report_entry" tabindex="0">
                <div class="report_entry_title">存在问题</div>
                <div style="margin:0 auto;width:95%">
                    <div class="report_menu report_menu_problem" tabindex="0" style="margin:0 auto"></div>
                    <div class="report_editor report_problem" style="margin:0 auto"></div>
                </div>
            </div>
            <div class="report_entry" tabindex="0">
                <div class="report_entry_title">下周计划</div>
                <div style="margin:0 auto;width:95%">
                    <div class="report_menu report_menu_plan" tabindex="0" style="margin:0 auto"></div>
                    <div class="report_editor report_plan" style="border-right: 3px solid rgb(245,245,245);margin:0 auto"></div>
                </div>
            </div>
        </div>
        <div style="height:1px; margin-top:10px;clear: both;overflow: hidden"></div>
        <div style="width:90%;height:1px; margin:20px auto;clear: both;border-bottom:3px solid rgb(245,245,245);margin-bottom: 20px"></div>
    </div>
    {{/props}}
    <div id="add_report" style="font-size: 16px;height: 35px;width:150px;line-height: 35px;margin-left: 30px;color:rgb(130,195,255);cursor:pointer;">
    + 点击添加一项周报
</div>
</script>

<div class="report_submit" style="display: none">提交</div>
<div style="height:1px; margin-top:20px;clear: both;overflow: hidden"></div>
<script>
require(["reportItem"], function(ReportController) {
    // console.log(ri);
    var report_controller = new ReportController();
    var app = {
        reportItem: report_controller.items,
    };
    var myTemplate = $.templates("#addReportTmpl");  

    myTemplate.link(".panel", app);

    // report_controller.init()
    $("#add_report").click(function() {
        report_controller.addReportItem();

    })
    $(".report_submit").click(function() {
        report_controller.submit();
    })
    $(document).on('click', "[name='report_item_remove']", function() {

        var item = $(this).closest(".report_item").attr("item");
        report_controller.removeReportItem(item);
        //$(this).before(report_item) ;
    })

    $(document).on("click", "[level^=l] [role=menuitem]", function() {
        //点击周报项目选择项目选项
        var text = $(this).text();
        var level = $(this).closest("[level^=l]").attr("level").substring(1, 2)
        var id = $(this).attr("catagory_id");
        var item_key = $(this).closest(".report_item").attr("item");
        $(this).closest("[level^=l]").prevAll(".report_category_dropdown").html(text);

        report_controller.selectCatagory(item_key, level, id)
    })

    
});
</script>